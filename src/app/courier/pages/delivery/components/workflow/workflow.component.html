<div class="delivery-workflow">
  <!-- ุญุงูุฉ ุงูุชุญููู -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner">โณ</div>
    <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุทูุจ...</p>
  </div>

  <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
  <div *ngIf="!isLoading && job" class="content">
    
    <!-- ุงูุนููุงู -->
    <div class="header">
      <button class="back-btn" (click)="goBack()">โ ุฑุฌูุน</button>
      <h1>ุชุณููู ุงูุทูุจ</h1>
      
      <div class="order-header">
        <span class="order-id">#{{ job.id || job.trackingNumber || jobId }}</span>
        <span class="order-status">{{ job.status || 'ููุฏ ุงููุนุงูุฌุฉ' }}</span>
      </div>
    </div>

    <!-- ูุนูููุงุช ุงูุทูุจ -->
    <div class="order-card">
      <h2>ูุนูููุงุช ุงูุทูุจ</h2>
      
      <div class="info-grid">
        <div class="info-item">
          <span class="label">ุงูุนููู:</span>
          <span class="value">{{ job.customerName || job.receiverName || 'ุบูุฑ ูุญุฏุฏ' }}</span>
        </div>
        
        <div class="info-item">
          <span class="label">ุงููุงุชู:</span>
          <span class="value">{{ job.customerPhone || job.receiverPhone || 'ุบูุฑ ูุชุงุญ' }}</span>
        </div>
        
        <div class="info-item full-width">
          <span class="label">ุนููุงู ุงูุชุณููู:</span>
          <span class="value">{{ job.deliveryAddress || 'ุบูุฑ ูุญุฏุฏ' }}</span>
        </div>
        
        <div *ngIf="job.pickupAddress" class="info-item full-width">
          <span class="label">ุนููุงู ุงูุงุณุชูุงู:</span>
          <span class="value">{{ job.pickupAddress }}</span>
        </div>
        
        <div *ngIf="job.codAmount && job.codAmount > 0" class="info-item cod">
          <span class="label">ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู:</span>
          <span class="value">{{ job.codAmount }} ุฌ.ู</span>
        </div>
        
        <div *ngIf="job.items" class="info-item full-width">
          <span class="label">ุงููุญุชููุงุช:</span>
          <span class="value">{{ job.items }}</span>
        </div>
      </div>
    </div>

    <!-- ุฃุฒุฑุงุฑ ุงูุชูููุฐ ุงูุณุฑูุน -->
    <div class="quick-actions">
      <button class="action-btn map" (click)="openGoogleMaps()">
        ๐บ๏ธ ูุชุญ ุงูุฎุฑูุทุฉ
      </button>
      
      <button class="action-btn call" (click)="callCustomer()">
        ๐ ุงูุงุชุตุงู ุจุงูุนููู
      </button>
    </div>

    <!-- ุฎุทูุงุช ุงูุชุณููู -->
    <div class="steps-container">
      <h2>ุฎุทูุงุช ุงูุชุณููู</h2>
      
      <div class="steps">
        <div *ngFor="let step of steps" 
             class="step"
             [class.completed]="step.status === 'completed'"
             [class.current]="step.status === 'current'"
             [class.pending]="step.status === 'pending'">
          
          <div class="step-icon">{{ step.icon }}</div>
          
          <div class="step-content">
            <h3>{{ step.title }}</h3>
            <p>{{ getStepDescription(step.action) }}</p>
          </div>
          
          <div class="step-action">
            <div *ngIf="step.status === 'completed'" class="done">
              โ ุชู
            </div>
            
            <button *ngIf="step.status === 'current'" 
                    class="execute-btn"
                    (click)="executeStep(step)">
              ุชูููุฐ
            </button>
            
            <div *ngIf="step.status === 'pending'" class="waiting">
              ูุงุฏู
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ุฒุฑ ุงูุฅููุงุก (ูุธูุฑ ููุท ุนูุฏ ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ) -->
    <div *ngIf="currentStep === 4" class="completion-options">
      <h3>ุงุฎุชุฑ ูุชูุฌุฉ ุงูุชุณููู:</h3>
      
      <div class="options">
        <button class="success-btn" (click)="openDeliveryProof()">
          โ ูุฌุงุญ ุงูุชุณููู
        </button>
        
        <button class="failure-btn" (click)="openFailedProof()">
          โ ูุดู ุงูุชุณููู
        </button>
      </div>
    </div>

    <!-- ููุงุญุธุงุช -->
    <div *ngIf="job.notes" class="notes">
      <h3>ููุงุญุธุงุช:</h3>
      <p>{{ job.notes }}</p>
    </div>
  </div>

  <!-- ุงูููุฏุงูุงุช (ุจุงุณุชุฎุฏุงู ุงูููููุงุช ุงูููุฌูุฏุฉ ูุฏูู) -->
  @if (showProofModal) {
    <app-delivery-proof
      [isVisible]="showProofModal"
      [job]="job"
      (onComplete)="handleDeliveryComplete($event)"
      (onCancel)="cancelModal()">
    </app-delivery-proof>
  }

  @if (showFailedProofModal) {
    <app-failed-delivery-proof
      [isVisible]="showFailedProofModal"
      [job]="job"
      (onSubmit)="handleDeliveryFailure($event)"
      (onCancel)="cancelModal()">
    </app-failed-delivery-proof>
  }
</div>